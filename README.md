# Μεταγλώττιση και εκτέλεση #
Για την μεταγλώττιση του προγράμματος τρέχτε την εντολή: make.
Για την μεταγλώττιση του προγράμματος τρέχτε την εντολή: ./main


# Σημεία προσοχής κατά την εκτέλεση των test #
- Τα συμβολά > , >>, <, |, & να προηγούνται και να έπονται από κενό χαρακτήρα για να ερμηνευτούν ορθά. Να σημειωθεί ότι το ερωτηματικό στο τελός της εντολής πχ ./count1 &; δεν ενοχλεί.
- Σύμφωνα με τον parser που έχω υλοποιήσει, τα " αγνοούνται. 
Δηλαδή, createalias lll "ls -las" σημαίνει lll = ls -las όχι lll = "ls -las".
- Για να εκτελεστεί ένα πρόγραμμα, γράψτε ./name όχι name στο terminal.
πχ ./count1 &; ./count2 &; αντί για count1&;count2&;
- Οι εντολές τύπου myHistory i είναι 0-based.
- Η εντολή cd δεν μπορεί να είναι ενδιάμεση εντολή σε σωλήνωση, ανακατεύθυνση ή Background.

# Δομή της εργασίας #
Η εργασία απαρτίζεται από:
- main.c που περιέχει τη βασική συνάρτηση εκτέλεσης του προγράμματος και τη mysh_loop() του υλοποιημένου κελύφους.
- το φάκελο modules που περιέχει τις υλοποιησείς των περισσότερων λειτουργιών εργασίας.
- το φάκελό include που περιέχει τους ορισμούς των συναρτήσεων που υλοποιούνται στο φακελό modules.

# main() #
Η main() καλεί τη mysh_loop(). 

# mysh_loop() #
Η mysh_loop() διαβάζει επαναληπτικά τις εντολές του χρήστη, της ερμηνευεί και είτε τις έκτελει είτε δημιουργεί ένα αντιγραφό της τρέχουσας διεργασίας και αναθέτει την εκτέλση της εντολής στη συνάρτηση main_execution() για εκτέλεση. Η επανάληψη αυτή σταματάει όταν ο χρήστης δώσει την εντολή exit.
Οι εντολές που εκτελούνται είναι
- exit, ώστε να γίνει έξοδος από τη διεργασία που εκτελείται το shell.
- createalias/ destroyalias, ώστε να ενημερώνεται ο vector της διεργασίας που εκτελείται το shell. 
- Ευρευσή των alias στην εντολή εκτέλεσης. Να σημειωθεί ότι πρώτα εκετελείται η εντολή destroyalias και μετά η αντικατάσταση των alias στην εντολή.
- myHistory i, εδώ γίνεται ο εντοπισμός της i-στης εντολής, ώστε μετά να μπορεί να προστεθεί στο ιστορικό.
- cd path & cd .. & cd wildcard
- Ενημέρωση του ιστορικού, ώστε να ενημερώνεται ο vector της διεργασίας που εκτελείται το shell.

Parser:
Το προγραμμά λαμβάνει μία εντολή από το χρήστη με τη getline. 
Έπειτα, χωρίζει τη γραμμή σε εντολές με τη χρήση της strtok και με delimiter to ;
Στη συνέχεια, χωρίζει την κάθε εντολή σε tokens, με τη χρήση stringstream, και την εκτελεί. Οι υποσυμβολοσειρές μεσά σε " " (προσοχή, όχι σε “ ”) ερμηνεύονται ως ενα token και αποθηκεύονται χωρίς τα " ".

Signals: 
Στην διεργασία που φιλοξενεί στο shell, εφαρμόζεται SIG_IGN για τα σήματα control-C και control-Ζ, ενώ όταν γίνεται fork, στη διεργασία παιδί στην οποία εκτελούνται οι εντολές εφαρμόζεται SIG_DFL ώστε σε αυτές να μπορέσουν να εφαρμοστπύν τα σήματα.

# main_execution() #
Η συνάρτηση αυτή ελέγει αν η εντολή που δώθηκε 
- είτε πρέπει να εκτελεστεί στο backround, είτε περιέχει κάποια ανακατεύθυνση, είτε περιέχει κάποιο pipe, είτε περιέχει συμβολοσειρά με wild characters που τοτέ τις προωθεί στις κατάλληλες συναρτήσεις χειρισμού, 
- είτε ελέγχει αν είναι η εντολή myHistory, που σε αυτή τη περίπτωση την εκτελεί, 
- είτε ελέγχει αν είναι εντολή aliasing, που σε αυτή τη περίπτωση την αγνοεί.
Σε όλες τις περιπτώσεις αυτές η συνάρτηση αυτή επιστρέφει 0.
Στη περίπτωση που δωθεί ως όρισμα μια απλή εντολή εκτέλεσης, η συνάτηση επιστρέφει 1, ώστε η συνάρτηση που την κάλεσε να επιλέξει αν θέλει να την εκτελέσει κάνοντας fork (συνάρτηση execute), ή χωρίς (συνάρτηση execute_without_fork).

Η συνάρτηση αυτή δε χρησιμοποιείται μόνο από τη mysh_loop, αλλά και από τις συναρτήσεις execute_bg, redirection_output, redirection_output_double, redirection_input, handle_pipes για να χειριστούν τις υποεντολές που περιέχουν οι εντολές που έλαβαν ως όρισμα.

# Ανακατεύθυνση #
- Ανακατεύθυνση εισόδου  
Υλοποιείται με τη συνάρτηση redirection_input, η οποία 
    - ανοίγει το ζητούμενο αρχείο μόνο για ανάγνωση
    - αποθηκεύει το STDIN_FILENO για να το επαναφέρει αργότερα
    - ανακατευθύνει το input στο ζητούμενο αρχείο
    - εκτελεί τις ενέργειες που πρέπει να εκτελεστούν με βάση το κομμάτι της εντολής που δεν    περιέχει ανακατεύθυνση. Στη περίπτωση απλής εντολής επιλέγεται εκτέλεση με fork, διότι δεν γίνεται fork κάπου αλλού στο πλαίσιο της συγκεκριμένης εντολής
    - επαναφέρει το STDIN_FILENO στο input
    - κλείνει το αρχείο

- Ανακατεύθυνση εξόδου 
Υλοποιείται με τη συνάρτηση redirection_output, η οποία 
    - ανοίγει το ζητούμενο αρχείο για γράψιμο, χωρίς append
    - αποθηκεύει το STDOUT_FILENO για να το επαναφέρει αργότερα
    - ανακατευθύνει το output στο ζητούμενο αρχείο
    - εκτελεί τις ενέργειες που πρέπει να εκτελεστούν με βάση το κομμάτι της εντολής που δεν    περιέχει ανακατεύθυνση. Στη περίπτωση απλής εντολής επιλέγεται εκτέλεση με fork, διότι δεν γίνεται fork κάπου αλλού στο πλαίσιο της συγκεκριμένης εντολής
    - επαναφέρει το STDOUT_FILENO στο output
    - κλείνει το αρχείο

- Ανακατεύθυνση εξόδου προσθήκης σε υπάρχον αρχείο
Υλοποιείται με τη συνάρτηση redirection_output_double, η οποία 
    - ανοίγει το ζητούμενο αρχείο για γράψιμο, με append
    - αποθηκεύει το STDOUT_FILENO για να το επαναφέρει αργότερα
    - ανακατευθύνει το output στο ζητούμενο αρχείο
    - εκτελεί τις ενέργειες που πρέπει να εκτελεστούν με βάση το κομμάτι της εντολής που δεν    περιέχει ανακατεύθυνση. Στη περίπτωση απλής εντολής επιλέγεται εκτέλεση με fork, διότι δεν γίνεται fork κάπου αλλού στο πλαίσιο της συγκεκριμένης εντολής
    - επαναφέρει το STDOUT_FILENO στο output
    - κλείνει το αρχείο

# Σωλήνωση #
Υλοποιείται με τη συνάρτηση handle_pipes, η οποία: 
- εντοπίζει την πρώτη | απότα αριστερά στην εντολή που δώθηκε και χωρίζει την εντολή σε 2 εντολές με βάση αυτή
- ξεκινάει την υλοποίηση του pipe με τις εντολές int fd[2]; pipe(fd);
- στη συνέχεια, εκτελεί ένα fork 
- στη διεργασία παιδί , ανατίτεθαι το input του pipe, κλείνουν τα άκρα του pipe που δε χρειάζονται και εκτελείται η "αριστερή" εντολή
- στη διεργασία γονίος εκτελεί άλλο ένα fork 
- στη νέα διεργασία παιδί, ανατίτεθαι το  output του pipe, κλείνουν τα άκρα του pipe που δε χρειάζονται και εκτελείται η "δεξία" εντολή
- τέλος, στη διεργασία γονιός κλείνει τα άκρα του pipe και περιμένει τις διεργασίες παιδιά να ολοκληρωθούν.
Στη περίπτωση απλής εντολής επιλέγεται εκτέλεση χωρίς fork, διότι γίνεται fork νωρίτερα.

# Background #
Υλοποιείται με τη συνάρτηση execute_bg, η οποία λαμβάνει την εντολή από τη main_execution χωρίς το &. Μοιάζει αρκετά την την συνάρτηση απλής εκτέλεσης με fork, αλλά έχει τις εξής διαφορές: 
- η διεργασία γονίος δεν περιμένει τη διεργασία παιδί να ολοκληρωθεί
- δημιουργείται ένα νέο session και process group για τη διεργασία παιδί
- δεν εκτελεί μόνο απλές εντολές (main_execution)

# wild characters #
Υλοποιείται με τις συνάρτησεις
- handle_wildcards, η οποία βρίσκει πόσα αρχεία ταιριάζουν με το μοτιβό που δώθηκε και με τη συνάρτηση, η οποία χρησιμοποεί την βιβλιοθήκη glob.h
- exec_wildcards, η οποία για κάθε αποτέλεσμα της handle_wildcards, εκτελεί την εντολή που πρέπει να εκτελεστεί. Επιπλέον, χειρίζεται την ειδική περιπτωσή της εντολής cd wildcard, διότι απαιτεί η αναζήτηση για αντιστοιχίες να γίνει στους φακέλους του τρέχοντος φακέλου και όχι στα αρχεία. Αν βρεθεί ακριβώς μια αντιστοιχία, τότε εκτελείται η εντολή cd αντιστοιχία, αλλιώς εκτυπώνεται μήνυμα λάθους.

# Αliases #
Για την αποθήκευση των aliases χρησιμοποιώ ένα map, τον οποίο ενημερώνω στην διεργασία που φιλοξενεί στο shell. Επιπλέον, επιλέγω να κάνω τις απαραίτητες αντικαταστάσεις στις εντολές που δίνονται από το χρήστη στην διεργασία που φιλοξενεί στο shell.

# Διαχείριση Σημάτων #
Στην διεργασία που φιλοξενεί στο shell, εφαρμόζεται SIG_IGN για τα σήματα control-C και control-Ζ, ενώ όταν γίνεται fork, στη διεργασία παιδί στην οποία εκτελούνται οι εντολές εφαρμόζεται SIG_DFL ώστε σε αυτές να μπορέσουν να εφαρμοστπύν τα σήματα.

# myHistory #
- Για την αποθήκευση του history χρησιμοποιώ ένα vector, τον οποίο ενημερώνω στην διεργασία που φιλοξενεί στο shell. 
- Η εντολή myHistory υλοποιείται από τη διεργασία παιδί. Όταν εκτελέσουμε την συγκεκριμένη εντολή, δεν προσθέτω κάποια εντολή στο history.
- Η ερμηνεία της εντολής myHistory i, γίνεται στη διεργασία γονίος, ώστε μετά να μπορεί να προστεθεί στο ιστορικό. Ενώ, η εκτέλεση της γίνεται στο σημείο που θα έπρεπε να εκτελεστεί η συγκεκριμένη εντολή με βάση τα παραπάνω. 

# execute & execute_without_fork #
Για εκτέλεση απλών εντολών του συστήματος (εξαιρούνται οι cd, exit πχ ls) μπορεί να χρησιμοποιηθεί είτε η συνάρτηση execute για εκτέλεση σε θηγατρική διεργασία, είτε η συνάρτηση execute_without_fork για εκτέλεση στην ίδια διεργασία.
